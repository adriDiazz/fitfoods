import style from './Dashboard.module.css';
import { Flex, BarChart, Card, Metric, Text } from '@tremor/react';

import { fetchFood, getAllExecisesbyMuscleId } from '../../utils/services';

import { useState, useEffect } from 'react';

const dataFormatter = number => {
	return Intl.NumberFormat('us').format(number).toString();
};

const Dashboard = () => {
	const [ejercicios, setEjercicios] = useState();
	const [food, setFood] = useState();
	const [foodTypeQty, setFoodTypeQty] = useState({});
	useEffect(() => {
		getAllExecisesbyMuscleId(setEjercicios);
		fetchFood(setFood);
	}, []);

	useEffect(() => {
		let breakfast = 0;
		let lunch = 0;
		let dinner = 0;
		let snack = 0;

		food?.data.forEach(f => {
			if (f.type === 'breakfast') {
				breakfast++;
			} else if (f.type === 'lunch') {
				lunch++;
			} else if (f.type === 'dinner') {
				dinner++;
			} else {
				snack++;
			}
		});
		setFoodTypeQty({ breakfast, lunch, dinner, snack });
	}, [food]);

	const musculos = ejercicios?.data.musclos;
	const exerciseCountByMuscle = ejercicios?.data.exerciseCountByMuscle;

	const chartdata3 = musculos?.map(musculo => ({
		name: musculo.name,
		'Numero de ejercicios': exerciseCountByMuscle[musculo.id]
	}));

	console.log(chartdata3);

	return (
		<div className={style.wrapper}>
			<Flex className={style.wrapper}>
				<Card decoration='top' decorationColor='red'>
					<div className={style.CardContent}>
						<div>
							<svg
								width='76'
								height='76'
								viewBox='0 0 76 76'
								fill='none'
								xmlns='http://www.w3.org/2000/svg'
							>
								<path
									d='M52.25 21.9688C51.6068 21.9688 51.0501 21.7337 50.5801 21.2637C50.11 20.7936 49.875 20.237 49.875 19.5938C49.875 18.332 50.11 17.1198 50.5801 15.957C51.0501 14.7943 51.7428 13.7676 52.6582 12.877L55.5898 9.9082C56.5299 8.9681 57 7.84245 57 6.53125C57 5.88802 57.235 5.33138 57.7051 4.86133C58.1751 4.39128 58.7318 4.15625 59.375 4.15625C60.0182 4.15625 60.5749 4.39128 61.0449 4.86133C61.515 5.33138 61.75 5.88802 61.75 6.53125C61.75 7.79297 61.515 9.00521 61.0449 10.168C60.5749 11.3307 59.8822 12.3574 58.9668 13.248L56.0352 16.2168C55.0951 17.1569 54.625 18.2826 54.625 19.5938C54.625 20.237 54.39 20.7936 53.9199 21.2637C53.4499 21.7337 52.8932 21.9688 52.25 21.9688ZM38 21.9688C37.3568 21.9688 36.8001 21.7337 36.3301 21.2637C35.86 20.7936 35.625 20.237 35.625 19.5938C35.625 18.332 35.86 17.1198 36.3301 15.957C36.8001 14.7943 37.4928 13.7676 38.4082 12.877L41.3398 9.9082C42.2799 8.9681 42.75 7.84245 42.75 6.53125C42.75 5.88802 42.985 5.33138 43.4551 4.86133C43.9251 4.39128 44.4818 4.15625 45.125 4.15625C45.7682 4.15625 46.3249 4.39128 46.7949 4.86133C47.265 5.33138 47.5 5.88802 47.5 6.53125C47.5 7.79297 47.265 9.00521 46.7949 10.168C46.3249 11.3307 45.6322 12.3574 44.7168 13.248L41.7852 16.2168C40.8451 17.1569 40.375 18.2826 40.375 19.5938C40.375 20.237 40.14 20.7936 39.6699 21.2637C39.1999 21.7337 38.6432 21.9688 38 21.9688ZM68.875 28.5C69.8646 28.5 70.7923 28.6855 71.6582 29.0566C72.5241 29.4277 73.2786 29.9349 73.9219 30.5781C74.5651 31.2214 75.0723 31.9759 75.4434 32.8418C75.8145 33.7077 76 34.6354 76 35.625V49.875C76 50.8646 75.8145 51.7923 75.4434 52.6582C75.0723 53.5241 74.5651 54.2786 73.9219 54.9219C73.2786 55.5651 72.5241 56.0723 71.6582 56.4434C70.7923 56.8145 69.8646 57 68.875 57H66.7598C66.7103 57.1732 66.6732 57.334 66.6484 57.4824C66.6237 57.6309 66.5742 57.7793 66.5 57.9277V59.375C66.5 61.0078 66.1908 62.5417 65.5723 63.9766C64.9538 65.4115 64.1003 66.6732 63.0117 67.7617C61.9232 68.8503 60.6615 69.7038 59.2266 70.3223C57.7917 70.9408 56.2578 71.25 54.625 71.25H40.375C38.4453 71.25 36.6641 70.8171 35.0312 69.9512C33.3984 69.0853 32.0378 67.9349 30.9492 66.5H12.3945C10.7617 66.5 9.22786 66.1908 7.79297 65.5723C6.35807 64.9538 5.09635 64.1126 4.00781 63.0488C2.91927 61.985 2.06576 60.7233 1.44727 59.2637C0.828776 57.804 0.519531 56.2578 0.519531 54.625V52.25H10.0195C10.0195 50.2956 10.3906 48.4525 11.1328 46.7207C11.875 44.9889 12.9017 43.4798 14.2129 42.1934C15.5241 40.9069 17.0332 39.8802 18.7402 39.1133C20.4473 38.3464 22.2904 37.9753 24.2695 38C25.0117 38 25.7292 38.0618 26.4219 38.1855C27.1146 38.3092 27.8073 38.4824 28.5 38.7051V23.75H66.5V28.5H68.875ZM24.2695 42.75C22.9583 42.75 21.7337 42.9974 20.5957 43.4922C19.4577 43.987 18.4434 44.6673 17.5527 45.5332C16.6621 46.3991 15.9818 47.401 15.5117 48.5391C15.0417 49.6771 14.7943 50.9141 14.7695 52.25H28.5V43.7891C27.8568 43.4674 27.1888 43.2201 26.4961 43.0469C25.8034 42.8737 25.0612 42.7747 24.2695 42.75ZM12.3945 61.75H28.7598C28.5866 61.0326 28.5 60.2409 28.5 59.375V57H5.67773C5.92513 57.6927 6.27148 58.3236 6.7168 58.8926C7.16211 59.4616 7.66927 59.9688 8.23828 60.4141C8.80729 60.8594 9.45052 61.181 10.168 61.3789C10.8854 61.5768 11.6276 61.7005 12.3945 61.75ZM29.5762 64.2363V64.2734L29.6133 64.3477V64.3105L29.5762 64.2363ZM61.75 59.375V28.5H33.25V59.375C33.25 60.3646 33.4355 61.2923 33.8066 62.1582C34.1777 63.0241 34.6849 63.7786 35.3281 64.4219C35.9714 65.0651 36.7259 65.5723 37.5918 65.9434C38.4577 66.3145 39.3854 66.5 40.375 66.5H54.625C55.6146 66.5 56.5423 66.3145 57.4082 65.9434C58.2741 65.5723 59.0286 65.0651 59.6719 64.4219C60.3151 63.7786 60.8223 63.0241 61.1934 62.1582C61.5645 61.2923 61.75 60.3646 61.75 59.375ZM71.25 49.875V35.625C71.25 34.9818 71.015 34.4251 70.5449 33.9551C70.0749 33.485 69.5182 33.25 68.875 33.25H66.5V52.25H68.875C69.5182 52.25 70.0749 52.015 70.5449 51.5449C71.015 51.0749 71.25 50.5182 71.25 49.875Z'
									fill='#374151'
								/>
							</svg>
						</div>
						<div>
							<Text>Breakfast</Text>
							<Metric>{foodTypeQty.breakfast}</Metric>
						</div>
					</div>
				</Card>

				<Card decoration='top' decorationColor='indigo'>
					<div className={style.CardContent}>
						<div>
							<svg
								width='76'
								height='76'
								viewBox='0 0 76 76'
								fill='none'
								xmlns='http://www.w3.org/2000/svg'
							>
								<path
									d='M6.33326 31.6667V28.5C6.33326 22.4306 9.19698 17.746 14.9244 14.4463C20.6519 11.1467 28.3437 9.49789 37.9999 9.5C47.6583 9.5 55.3511 11.1498 61.0786 14.4495C66.806 17.7492 69.6687 22.4327 69.6666 28.5V31.6667H6.33326ZM13.1416 25.3333H62.8583C61.6444 22.2722 58.8334 19.9236 54.4254 18.2875C50.0174 16.6514 44.5423 15.8333 37.9999 15.8333C31.4555 15.8333 25.9793 16.6514 21.5713 18.2875C17.1633 19.9236 14.3534 22.2722 13.1416 25.3333ZM6.33326 45.9167V39.5833C8.23326 39.5833 9.73742 39.0556 10.8458 38C11.9541 36.9444 13.986 36.4167 16.9416 36.4167C19.8971 36.4167 21.9027 36.9444 22.9583 38C24.0138 39.0556 25.4916 39.5833 27.3916 39.5833C29.2916 39.5833 30.7958 39.0556 31.9041 38C33.0124 36.9444 35.0444 36.4167 37.9999 36.4167C40.9555 36.4167 42.9874 36.9444 44.0958 38C45.2041 39.0556 46.7083 39.5833 48.6083 39.5833C50.5083 39.5833 51.986 39.0556 53.0416 38C54.0971 36.9444 56.1027 36.4167 59.0583 36.4167C62.0138 36.4167 64.0985 36.9444 65.3124 38C66.5263 39.0556 67.9777 39.5833 69.6666 39.5833V45.9167C66.711 45.9167 64.7319 45.3889 63.7291 44.3333C62.7263 43.2778 61.2749 42.75 59.3749 42.75C57.4749 42.75 55.9444 43.2778 54.7833 44.3333C53.6221 45.3889 51.5638 45.9167 48.6083 45.9167C45.6527 45.9167 43.6208 45.3889 42.5124 44.3333C41.4041 43.2778 39.8999 42.75 37.9999 42.75C36.0999 42.75 34.5958 43.2778 33.4874 44.3333C32.3791 45.3889 30.3471 45.9167 27.3916 45.9167C24.436 45.9167 22.4305 45.3889 21.3749 44.3333C20.3194 43.2778 18.8416 42.75 16.9416 42.75C15.0416 42.75 13.5374 43.2778 12.4291 44.3333C11.3208 45.3889 9.28881 45.9167 6.33326 45.9167ZM12.6666 66.5C10.9249 66.5 9.43342 65.8793 8.19209 64.638C6.95076 63.3967 6.33115 61.9062 6.33326 60.1667V50.6667H69.6666V60.1667C69.6666 61.9083 69.0459 63.3998 67.8046 64.6412C66.5633 65.8825 65.0728 66.5021 63.3333 66.5H12.6666ZM12.6666 60.1667H63.3333V57H12.6666V60.1667Z'
									fill='#374151'
								/>
							</svg>
						</div>
						<div>
							<Text>Lunch</Text>
							<Metric>{foodTypeQty.lunch}</Metric>
						</div>
					</div>
				</Card>

				<Card decoration='top' decorationColor='orange'>
					<div className={style.CardContent}>
						<div>
							<svg
								width='76'
								height='76'
								viewBox='0 0 76 76'
								fill='none'
								xmlns='http://www.w3.org/2000/svg'
							>
								<path
									d='M17.2267 25.2067L18.8734 23.5283C20.7101 21.6917 23.7501 21.6917 25.6501 23.655L25.7134 23.75C27.2651 25.3333 29.3234 26.0933 31.5717 26.315C34.6434 26.6 37.6201 28.2467 39.5834 31.2233C41.7367 34.6433 41.7051 39.2033 39.4567 42.5917C38.6087 43.9327 37.4683 45.0645 36.121 45.9024C34.7736 46.7403 33.2541 47.2626 31.6763 47.4301C30.0985 47.5976 28.5033 47.4061 27.01 46.8698C25.5167 46.3335 24.1641 45.4664 23.0534 44.3333C21.2801 42.5917 20.2667 40.3433 20.0134 38C19.7601 35.6883 18.8417 33.5033 17.2267 31.8883C15.3901 30.0833 15.3901 27.0433 17.2267 25.2067ZM30.5267 50.6667C26.8217 50.6667 23.3701 49.2417 20.8051 46.6133C18.5884 44.3333 17.1951 41.4833 16.8467 38.38C16.7517 37.43 16.4667 36.195 15.7067 35.055C13.8067 37.6833 12.6667 40.85 12.6667 44.3333C12.6667 49.5267 15.2001 54.1183 19.0951 57H60.1667V53.8333C60.1667 42.4333 52.5984 32.775 42.2434 29.6083C45.0617 34.0417 44.9984 39.9633 42.1167 44.3333C39.5834 48.2917 35.2134 50.6667 30.5267 50.6667ZM46.8034 23.94H50.8251C53.5801 23.94 55.9867 25.8717 55.9867 29.3233V31.6667H59.9451V28.5C59.9451 23.75 55.7334 20.14 50.8251 20.14H46.8034C44.1751 20.14 41.9267 17.5433 41.9267 14.8833C41.9267 12.2233 44.1751 10.26 46.8034 10.26V6.33334C41.9267 6.33334 38.0001 10.26 38.0001 15.1367C38.0001 20.0133 41.9267 23.94 46.8034 23.94ZM14.2501 23.9083C14.4401 23.5917 14.6934 23.275 14.9784 22.9583L16.6251 21.3117C16.9101 21.0267 17.2267 20.805 17.5434 20.5833L13.0784 16.055C13.5217 15.2 13.3634 14.0917 12.6667 13.3633C12.2133 12.9219 11.6054 12.6749 10.9726 12.6749C10.3397 12.6749 9.73186 12.9219 9.27839 13.3633C8.83506 13.8067 8.61339 14.345 8.58173 14.915C8.01173 14.9467 7.47339 15.1683 7.03006 15.6117C6.11173 16.53 6.11173 18.05 7.03006 19C7.75839 19.6967 8.83506 19.855 9.72172 19.4117L14.2501 23.9083ZM58.2351 13.9017C59.8501 12.2867 60.8634 10.1017 60.8634 7.66334H56.9051C56.9051 10.2917 54.6884 12.5083 52.0601 12.5083V16.435C57.9501 16.435 62.5734 21.2483 62.5734 27.1383V34.8333H66.5001V27.1383C66.5159 24.3761 65.7477 21.666 64.2846 19.323C62.8216 16.9799 60.7239 15.1 58.2351 13.9017ZM15.8334 66.5H60.1667C63.6817 66.5 66.5001 63.6817 66.5001 60.1667H9.50006C9.50006 61.8464 10.1673 63.4573 11.355 64.645C12.5428 65.8328 14.1537 66.5 15.8334 66.5Z'
									fill='#374151'
								/>
							</svg>
						</div>
						<div>
							<Text>Dinner</Text>
							<Metric>{foodTypeQty.dinner}</Metric>
						</div>
					</div>
				</Card>

				<Card decoration='top' decorationColor='teal'>
					<div className={style.CardContent}>
						<div>
							<svg
								width='76'
								height='76'
								viewBox='0 0 76 76'
								fill='none'
								xmlns='http://www.w3.org/2000/svg'
							>
								<path
									d='M9.5 22.1666H66.5V12.6666H60.1667L57 6.33331H19L15.8333 12.6666H9.5V22.1666Z'
									stroke='#374151'
									strokeWidth='4'
									strokeLinejoin='round'
								/>
								<path
									d='M57 69.6667L60.1667 22.1667H15.8334L19 69.6667H57Z'
									stroke='#374151'
									strokeWidth='4'
									strokeLinecap='round'
									strokeLinejoin='round'
								/>
							</svg>
						</div>
						<div>
							<Text>Snack</Text>
							<Metric>{foodTypeQty.snack}</Metric>
						</div>
					</div>
				</Card>
			</Flex>
			<h1>Ejercicios por Músculo</h1>
			<BarChart
				data={chartdata3}
				index='name'
				categories={['Numero de ejercicios']}
				colors={['lime']}
				valueFormatter={dataFormatter}
				yAxisWidth={48}
			/>
		</div>
	);
};

export default Dashboard;
